---
# sysupgrade.yml

- name: upgrade to latest release or snapshot
  sysupgrade:
  register: sysupgrade

- name: reboot if upgraded
  reboot:
    connect_timeout: "{{ connect_timeout }}"
    reboot_timeout: "{{ reboot_timeout }}"
  when:
    - sysupgrade.changed

- name: (release) update packages
  command: >-
    pkg_add -u
  when:
    - sysupgrade.changed
    - ansible_distribution_release != "current"

- name: (current) reinstall snapshot packages
  command: >-
    pkg_add -ruD snap
  when:
    - sysupgrade.changed
    - ansible_distribution_release == "current"
